{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\n// Supabase configuration\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n\r\nif (!supabaseUrl || !supabaseServiceRoleKey) {\r\n  throw new Error('Missing Supabase environment variables')\r\n}\r\n\r\n// Create Supabase client (server-side only, uses service role key)\r\nexport const supabase = createClient(supabaseUrl, supabaseServiceRoleKey, {\r\n  auth: {\r\n    autoRefreshToken: false,\r\n    persistSession: false,\r\n    detectSessionInUrl: false,\r\n  },\r\n})\r\n\r\n// Types for better TypeScript support\r\nexport type Database = {\r\n  public: {\r\n    Tables: {\r\n      leads: {\r\n        Row: {\r\n          id: string\r\n          business_name: string\r\n          email: string | null\r\n          website: string | null\r\n          phone: string | null\r\n          industry: string\r\n          status: string\r\n          source: string\r\n          scraped_data: any | null\r\n          quality_score: number | null\r\n          email_sent_at: string | null\r\n          email_opened_at: string | null\r\n          email_clicked_at: string | null\r\n          email_replied_at: string | null\r\n          automation_paused: string | null\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          business_name: string\r\n          email?: string | null\r\n          website?: string | null\r\n          phone?: string | null\r\n          industry: string\r\n          status?: string\r\n          source?: string\r\n          scraped_data?: any | null\r\n          quality_score?: number | null\r\n          email_sent_at?: string | null\r\n          email_opened_at?: string | null\r\n          email_clicked_at?: string | null\r\n          email_replied_at?: string | null\r\n          automation_paused?: string | null\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          business_name?: string\r\n          email?: string | null\r\n          website?: string | null\r\n          phone?: string | null\r\n          industry?: string\r\n          status?: string\r\n          source?: string\r\n          scraped_data?: any | null\r\n          quality_score?: number | null\r\n          email_sent_at?: string | null\r\n          email_opened_at?: string | null\r\n          email_clicked_at?: string | null\r\n          email_replied_at?: string | null\r\n          automation_paused?: string | null\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n      }\r\n      // We'll add more tables in Prompt 3\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,yBAAyB;AACzB,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE,IAAI,CAAC,eAAe,CAAC,wBAAwB;IAC3C,MAAM,IAAI,MAAM;AAClB;AAGO,MAAM,WAAW,IAAA,yLAAY,EAAC,aAAa,wBAAwB;IACxE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;QAChB,oBAAoB;IACtB;AACF"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/app/api/admin/customer-success/metrics/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { supabase } from '@/lib/supabase'\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Get all health scores\r\n    const { data: health } = await supabase\r\n      .from('customer_health')\r\n      .select('health_score, risk_level')\r\n\r\n    const avgHealthScore = (health?.reduce((sum, h) => sum + h.health_score, 0) || 0) / (health?.length || 1)\r\n    const atRiskCount = health?.filter(h => h.risk_level === 'high' || h.risk_level === 'critical').length || 0\r\n\r\n    // Calculate churn rate (last 30 days)\r\n    const thirtyDaysAgo = new Date()\r\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30)\r\n\r\n    const { data: churned } = await supabase\r\n      .from('subscriptions')\r\n      .select('id')\r\n      .eq('status', 'canceled')\r\n      .gte('cancel_at', thirtyDaysAgo.toISOString())\r\n\r\n    const { data: active } = await supabase\r\n      .from('subscriptions')\r\n      .select('id')\r\n      .eq('status', 'active')\r\n\r\n    const churnRate = ((churned?.length || 0) / ((churned?.length || 0) + (active?.length || 1))) * 100\r\n\r\n    return NextResponse.json({\r\n      avgHealthScore: Math.round(avgHealthScore),\r\n      atRiskCount,\r\n      churnRate: Math.round(churnRate * 10) / 10,\r\n      npsScore: 85, // Placeholder - implement surveys later\r\n    })\r\n  } catch (error) {\r\n    console.error('Failed to get metrics:', error)\r\n    return NextResponse.json({ error: 'Failed to get metrics' }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,wBAAwB;QACxB,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,6HAAQ,CACpC,IAAI,CAAC,mBACL,MAAM,CAAC;QAEV,MAAM,iBAAiB,CAAC,QAAQ,OAAO,CAAC,KAAK,IAAM,MAAM,EAAE,YAAY,EAAE,MAAM,CAAC,IAAI,CAAC,QAAQ,UAAU,CAAC;QACxG,MAAM,cAAc,QAAQ,OAAO,CAAA,IAAK,EAAE,UAAU,KAAK,UAAU,EAAE,UAAU,KAAK,YAAY,UAAU;QAE1G,sCAAsC;QACtC,MAAM,gBAAgB,IAAI;QAC1B,cAAc,OAAO,CAAC,cAAc,OAAO,KAAK;QAEhD,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,6HAAQ,CACrC,IAAI,CAAC,iBACL,MAAM,CAAC,MACP,EAAE,CAAC,UAAU,YACb,GAAG,CAAC,aAAa,cAAc,WAAW;QAE7C,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,6HAAQ,CACpC,IAAI,CAAC,iBACL,MAAM,CAAC,MACP,EAAE,CAAC,UAAU;QAEhB,MAAM,YAAY,AAAC,CAAC,SAAS,UAAU,CAAC,IAAI,CAAC,CAAC,SAAS,UAAU,CAAC,IAAI,CAAC,QAAQ,UAAU,CAAC,CAAC,IAAK;QAEhG,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,gBAAgB,KAAK,KAAK,CAAC;YAC3B;YACA,WAAW,KAAK,KAAK,CAAC,YAAY,MAAM;YACxC,UAAU;QACZ;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}