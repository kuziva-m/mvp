{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\n// Supabase configuration\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n\r\nif (!supabaseUrl || !supabaseServiceRoleKey) {\r\n  throw new Error('Missing Supabase environment variables')\r\n}\r\n\r\n// Create Supabase client (server-side only, uses service role key)\r\nexport const supabase = createClient(supabaseUrl, supabaseServiceRoleKey, {\r\n  auth: {\r\n    autoRefreshToken: false,\r\n    persistSession: false,\r\n    detectSessionInUrl: false,\r\n  },\r\n})\r\n\r\n// Types for better TypeScript support\r\nexport type Database = {\r\n  public: {\r\n    Tables: {\r\n      leads: {\r\n        Row: {\r\n          id: string\r\n          business_name: string\r\n          email: string | null\r\n          website: string | null\r\n          phone: string | null\r\n          industry: string\r\n          status: string\r\n          source: string\r\n          scraped_data: any | null\r\n          quality_score: number | null\r\n          email_sent_at: string | null\r\n          email_opened_at: string | null\r\n          email_clicked_at: string | null\r\n          email_replied_at: string | null\r\n          automation_paused: string | null\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          business_name: string\r\n          email?: string | null\r\n          website?: string | null\r\n          phone?: string | null\r\n          industry: string\r\n          status?: string\r\n          source?: string\r\n          scraped_data?: any | null\r\n          quality_score?: number | null\r\n          email_sent_at?: string | null\r\n          email_opened_at?: string | null\r\n          email_clicked_at?: string | null\r\n          email_replied_at?: string | null\r\n          automation_paused?: string | null\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          business_name?: string\r\n          email?: string | null\r\n          website?: string | null\r\n          phone?: string | null\r\n          industry?: string\r\n          status?: string\r\n          source?: string\r\n          scraped_data?: any | null\r\n          quality_score?: number | null\r\n          email_sent_at?: string | null\r\n          email_opened_at?: string | null\r\n          email_clicked_at?: string | null\r\n          email_replied_at?: string | null\r\n          automation_paused?: string | null\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n      }\r\n      // We'll add more tables in Prompt 3\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,yBAAyB;AACzB,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE,IAAI,CAAC,eAAe,CAAC,wBAAwB;IAC3C,MAAM,IAAI,MAAM;AAClB;AAGO,MAAM,WAAW,IAAA,yLAAY,EAAC,aAAa,wBAAwB;IACxE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;QAChB,oBAAoB;IACtB;AACF"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/app/api/admin/dead-letter-queue/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { supabase } from '@/lib/supabase'\r\n\r\nexport async function GET() {\r\n  try {\r\n    const { data: jobs, error } = await supabase\r\n      .from('dead_letter_queue')\r\n      .select('*')\r\n      .eq('resolved', false)\r\n      .order('failed_at', { ascending: false })\r\n      .limit(100)\r\n\r\n    if (error) throw error\r\n\r\n    // Also get statistics\r\n    const { data: stats } = await supabase\r\n      .from('dead_letter_queue')\r\n      .select('queue_name, resolved')\r\n\r\n    const queueStats = stats?.reduce((acc: any, job) => {\r\n      if (!acc[job.queue_name]) {\r\n        acc[job.queue_name] = { total: 0, resolved: 0, unresolved: 0 }\r\n      }\r\n      acc[job.queue_name].total++\r\n      if (job.resolved) {\r\n        acc[job.queue_name].resolved++\r\n      } else {\r\n        acc[job.queue_name].unresolved++\r\n      }\r\n      return acc\r\n    }, {})\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      jobs: jobs || [],\r\n      count: jobs?.length || 0,\r\n      stats: queueStats || {},\r\n    })\r\n  } catch (error) {\r\n    console.error('Dead letter queue fetch error:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to fetch dead letter queue' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function PATCH(request: Request) {\r\n  try {\r\n    const { id, resolved, resolvedBy, notes } = await request.json()\r\n\r\n    const updateData: any = {\r\n      resolved,\r\n    }\r\n\r\n    if (resolved) {\r\n      updateData.resolved_at = new Date().toISOString()\r\n      updateData.resolved_by = resolvedBy\r\n    }\r\n\r\n    if (notes) {\r\n      updateData.notes = notes\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from('dead_letter_queue')\r\n      .update(updateData)\r\n      .eq('id', id)\r\n\r\n    if (error) throw error\r\n\r\n    return NextResponse.json({ success: true })\r\n  } catch (error) {\r\n    console.error('Dead letter queue update error:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to update job' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: Request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const id = searchParams.get('id')\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'ID required' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from('dead_letter_queue')\r\n      .delete()\r\n      .eq('id', id)\r\n\r\n    if (error) throw error\r\n\r\n    return NextResponse.json({ success: true })\r\n  } catch (error) {\r\n    console.error('Dead letter queue delete error:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to delete job' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAQ,CACzC,IAAI,CAAC,qBACL,MAAM,CAAC,KACP,EAAE,CAAC,YAAY,OACf,KAAK,CAAC,aAAa;YAAE,WAAW;QAAM,GACtC,KAAK,CAAC;QAET,IAAI,OAAO,MAAM;QAEjB,sBAAsB;QACtB,MAAM,EAAE,MAAM,KAAK,EAAE,GAAG,MAAM,6HAAQ,CACnC,IAAI,CAAC,qBACL,MAAM,CAAC;QAEV,MAAM,aAAa,OAAO,OAAO,CAAC,KAAU;YAC1C,IAAI,CAAC,GAAG,CAAC,IAAI,UAAU,CAAC,EAAE;gBACxB,GAAG,CAAC,IAAI,UAAU,CAAC,GAAG;oBAAE,OAAO;oBAAG,UAAU;oBAAG,YAAY;gBAAE;YAC/D;YACA,GAAG,CAAC,IAAI,UAAU,CAAC,CAAC,KAAK;YACzB,IAAI,IAAI,QAAQ,EAAE;gBAChB,GAAG,CAAC,IAAI,UAAU,CAAC,CAAC,QAAQ;YAC9B,OAAO;gBACL,GAAG,CAAC,IAAI,UAAU,CAAC,CAAC,UAAU;YAChC;YACA,OAAO;QACT,GAAG,CAAC;QAEJ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM,QAAQ,EAAE;YAChB,OAAO,MAAM,UAAU;YACvB,OAAO,cAAc,CAAC;QACxB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAoC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,MAAM,OAAgB;IAC1C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE9D,MAAM,aAAkB;YACtB;QACF;QAEA,IAAI,UAAU;YACZ,WAAW,WAAW,GAAG,IAAI,OAAO,WAAW;YAC/C,WAAW,WAAW,GAAG;QAC3B;QAEA,IAAI,OAAO;YACT,WAAW,KAAK,GAAG;QACrB;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAQ,CAC7B,IAAI,CAAC,qBACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM;QAEZ,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAuB,GAChD;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,OAAO,OAAgB;IAC3C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,KAAK,aAAa,GAAG,CAAC;QAE5B,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAc,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAQ,CAC7B,IAAI,CAAC,qBACL,MAAM,GACN,EAAE,CAAC,MAAM;QAEZ,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAuB,GAChD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}