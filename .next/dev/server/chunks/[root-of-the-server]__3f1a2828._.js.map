{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/lib/supabase.ts"],"sourcesContent":["// FIX: Ensure this file is never bundled to the client\r\nimport \"server-only\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\n// Supabase configuration\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\r\n\r\nif (!supabaseUrl || !supabaseServiceRoleKey) {\r\n  throw new Error(\"Missing Supabase environment variables\");\r\n}\r\n\r\n// Create Supabase client (server-side only, uses service role key)\r\n// This client has ADMIN privileges and bypasses Row Level Security (RLS)\r\nexport const supabase = createClient(supabaseUrl, supabaseServiceRoleKey, {\r\n  auth: {\r\n    autoRefreshToken: false,\r\n    persistSession: false,\r\n    detectSessionInUrl: false,\r\n  },\r\n});\r\n\r\n// Types for better TypeScript support\r\nexport type Database = {\r\n  public: {\r\n    Tables: {\r\n      leads: {\r\n        Row: {\r\n          id: string;\r\n          business_name: string;\r\n          email: string | null;\r\n          website: string | null;\r\n          phone: string | null;\r\n          industry: string;\r\n          status: string;\r\n          source: string;\r\n          scraped_data: any | null;\r\n          quality_score: number | null;\r\n          email_sent_at: string | null;\r\n          email_opened_at: string | null;\r\n          email_clicked_at: string | null;\r\n          email_replied_at: string | null;\r\n          automation_paused: string | null;\r\n          created_at: string;\r\n          updated_at: string;\r\n        };\r\n        Insert: {\r\n          id?: string;\r\n          business_name: string;\r\n          email?: string | null;\r\n          website?: string | null;\r\n          phone?: string | null;\r\n          industry: string;\r\n          status?: string;\r\n          source?: string;\r\n          scraped_data?: any | null;\r\n          quality_score?: number | null;\r\n          email_sent_at?: string | null;\r\n          email_opened_at?: string | null;\r\n          email_clicked_at?: string | null;\r\n          email_replied_at?: string | null;\r\n          automation_paused?: string | null;\r\n          created_at?: string;\r\n          updated_at?: string;\r\n        };\r\n        Update: {\r\n          id?: string;\r\n          business_name?: string;\r\n          email?: string | null;\r\n          website?: string | null;\r\n          phone?: string | null;\r\n          industry?: string;\r\n          status?: string;\r\n          source?: string;\r\n          scraped_data?: any | null;\r\n          quality_score?: number | null;\r\n          email_sent_at?: string | null;\r\n          email_opened_at?: string | null;\r\n          email_clicked_at?: string | null;\r\n          email_replied_at?: string | null;\r\n          automation_paused?: string | null;\r\n          created_at?: string;\r\n          updated_at?: string;\r\n        };\r\n      };\r\n    };\r\n  };\r\n};\r\n"],"names":[],"mappings":"AAAA,uDAAuD;;;;;AACvD;AACA;;;AAEA,yBAAyB;AACzB,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE,IAAI,CAAC,eAAe,CAAC,wBAAwB;IAC3C,MAAM,IAAI,MAAM;AAClB;AAIO,MAAM,WAAW,IAAA,yLAAY,EAAC,aAAa,wBAAwB;IACxE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;QAChB,oBAAoB;IACtB;AACF"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/app/api/admin/lead-magnet/stats/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { supabase } from '@/lib/supabase'\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Get all submissions\r\n    const { data: submissions } = await supabase\r\n      .from('lead_magnet_submissions')\r\n      .select('*')\r\n\r\n    if (!submissions) {\r\n      return NextResponse.json({\r\n        totalSubmissions: 0,\r\n        totalGenerated: 0,\r\n        totalConverted: 0,\r\n        conversionRate: 0,\r\n        revenue: 0,\r\n        costPerLead: 0,\r\n        roi: 0,\r\n        campaignBreakdown: [],\r\n      })\r\n    }\r\n\r\n    // Calculate metrics\r\n    const totalSubmissions = submissions.length\r\n    const totalGenerated = submissions.filter(s => s.status === 'generated' || s.status === 'delivered' || s.status === 'converted').length\r\n    const totalConverted = submissions.filter(s => s.status === 'converted').length\r\n    const conversionRate = totalSubmissions > 0 ? (totalConverted / totalSubmissions) * 100 : 0\r\n\r\n    // Calculate revenue (assuming $99/month)\r\n    const revenue = totalConverted * 99\r\n\r\n    // Get total ad spend\r\n    const { data: campaigns } = await supabase\r\n      .from('lead_magnet_campaigns')\r\n      .select('ad_spend')\r\n\r\n    const totalAdSpend = campaigns?.reduce((sum, c) => sum + parseFloat(c.ad_spend || '0'), 0) || 0\r\n    const costPerLead = totalSubmissions > 0 ? totalAdSpend / totalSubmissions : 0\r\n    const roi = totalAdSpend > 0 ? ((revenue - totalAdSpend) / totalAdSpend) * 100 : 0\r\n\r\n    // Campaign breakdown\r\n    const { data: campaignData } = await supabase\r\n      .from('lead_magnet_campaigns')\r\n      .select(`\r\n        id,\r\n        name,\r\n        platform,\r\n        ad_spend,\r\n        submissions:lead_magnet_submissions(count)\r\n      `)\r\n\r\n    const campaignBreakdown = campaignData?.map(campaign => ({\r\n      id: campaign.id,\r\n      name: campaign.name,\r\n      platform: campaign.platform,\r\n      submissions: (campaign.submissions as any)?.length || 0,\r\n      adSpend: parseFloat(campaign.ad_spend || '0'),\r\n      costPerLead: (campaign.submissions as any)?.length > 0\r\n        ? parseFloat(campaign.ad_spend || '0') / (campaign.submissions as any).length\r\n        : 0,\r\n    })) || []\r\n\r\n    // Funnel metrics\r\n    const visited = submissions.filter(s => s.landing_page_visited_at).length\r\n    const formStarted = submissions.filter(s => s.form_started_at).length\r\n    const formCompleted = submissions.filter(s => s.form_completed_at).length\r\n    const generated = submissions.filter(s => s.website_generated_at).length\r\n    const delivered = submissions.filter(s => s.email_sent_at).length\r\n    const previewVisited = submissions.filter(s => s.preview_visited_at).length\r\n    const ctaClicked = submissions.filter(s => s.cta_clicked_at).length\r\n\r\n    return NextResponse.json({\r\n      totalSubmissions,\r\n      totalGenerated,\r\n      totalConverted,\r\n      conversionRate: Math.round(conversionRate * 10) / 10,\r\n      revenue,\r\n      costPerLead: Math.round(costPerLead * 100) / 100,\r\n      roi: Math.round(roi * 10) / 10,\r\n      campaignBreakdown,\r\n      funnelMetrics: {\r\n        visited,\r\n        formStarted,\r\n        formCompleted,\r\n        generated,\r\n        delivered,\r\n        previewVisited,\r\n        ctaClicked,\r\n        converted: totalConverted,\r\n      },\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Failed to get stats:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to get stats' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}