{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/lib/supabase.ts"],"sourcesContent":["// FIX: Ensure this file is never bundled to the client\r\nimport \"server-only\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\n// Supabase configuration\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\r\n\r\nif (!supabaseUrl || !supabaseServiceRoleKey) {\r\n  throw new Error(\"Missing Supabase environment variables\");\r\n}\r\n\r\n// Create Supabase client (server-side only, uses service role key)\r\n// This client has ADMIN privileges and bypasses Row Level Security (RLS)\r\nexport const supabase = createClient(supabaseUrl, supabaseServiceRoleKey, {\r\n  auth: {\r\n    autoRefreshToken: false,\r\n    persistSession: false,\r\n    detectSessionInUrl: false,\r\n  },\r\n});\r\n\r\n// Types for better TypeScript support\r\nexport type Database = {\r\n  public: {\r\n    Tables: {\r\n      leads: {\r\n        Row: {\r\n          id: string;\r\n          business_name: string;\r\n          email: string | null;\r\n          website: string | null;\r\n          phone: string | null;\r\n          industry: string;\r\n          status: string;\r\n          source: string;\r\n          scraped_data: any | null;\r\n          quality_score: number | null;\r\n          email_sent_at: string | null;\r\n          email_opened_at: string | null;\r\n          email_clicked_at: string | null;\r\n          email_replied_at: string | null;\r\n          automation_paused: string | null;\r\n          created_at: string;\r\n          updated_at: string;\r\n        };\r\n        Insert: {\r\n          id?: string;\r\n          business_name: string;\r\n          email?: string | null;\r\n          website?: string | null;\r\n          phone?: string | null;\r\n          industry: string;\r\n          status?: string;\r\n          source?: string;\r\n          scraped_data?: any | null;\r\n          quality_score?: number | null;\r\n          email_sent_at?: string | null;\r\n          email_opened_at?: string | null;\r\n          email_clicked_at?: string | null;\r\n          email_replied_at?: string | null;\r\n          automation_paused?: string | null;\r\n          created_at?: string;\r\n          updated_at?: string;\r\n        };\r\n        Update: {\r\n          id?: string;\r\n          business_name?: string;\r\n          email?: string | null;\r\n          website?: string | null;\r\n          phone?: string | null;\r\n          industry?: string;\r\n          status?: string;\r\n          source?: string;\r\n          scraped_data?: any | null;\r\n          quality_score?: number | null;\r\n          email_sent_at?: string | null;\r\n          email_opened_at?: string | null;\r\n          email_clicked_at?: string | null;\r\n          email_replied_at?: string | null;\r\n          automation_paused?: string | null;\r\n          created_at?: string;\r\n          updated_at?: string;\r\n        };\r\n      };\r\n    };\r\n  };\r\n};\r\n"],"names":[],"mappings":"AAAA,uDAAuD;;;;;AACvD;AACA;;;AAEA,yBAAyB;AACzB,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE,IAAI,CAAC,eAAe,CAAC,wBAAwB;IAC3C,MAAM,IAAI,MAAM;AAClB;AAIO,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa,wBAAwB;IACxE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;QAChB,oBAAoB;IACtB;AACF","debugId":null}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/lib/db.ts"],"sourcesContent":["import { supabase } from './supabase'\r\n\r\n/**\r\n * Database helper functions\r\n * Provides a clean API for common database operations\r\n */\r\n\r\n// Generic query helper\r\nexport async function query<T = any>(\r\n  table: string,\r\n  filters?: Record<string, any>\r\n): Promise<{ data: T[] | null; error: any }> {\r\n  try {\r\n    let queryBuilder = supabase.from(table).select('*')\r\n\r\n    // Apply filters if provided\r\n    if (filters) {\r\n      Object.entries(filters).forEach(([key, value]) => {\r\n        if (value !== undefined && value !== null) {\r\n          queryBuilder = queryBuilder.eq(key, value)\r\n        }\r\n      })\r\n    }\r\n\r\n    const { data, error } = await queryBuilder\r\n\r\n    if (error) {\r\n      console.error(`Query error on ${table}:`, error.message || error)\r\n      return { data: null, error }\r\n    }\r\n\r\n    return { data: data as T[], error: null }\r\n  } catch (error) {\r\n    console.error(`Unexpected error querying ${table}:`, error)\r\n    return { data: null, error }\r\n  }\r\n}\r\n\r\n// Generic insert helper\r\nexport async function insert<T = any>(\r\n  table: string,\r\n  data: Record<string, any> | Record<string, any>[]\r\n): Promise<{ data: T | null; error: any }> {\r\n  try {\r\n    const { data: insertedData, error } = await supabase\r\n      .from(table)\r\n      .insert(data)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(`Insert error on ${table}:`, error)\r\n      return { data: null, error }\r\n    }\r\n\r\n    return { data: insertedData as T, error: null }\r\n  } catch (error) {\r\n    console.error(`Unexpected error inserting into ${table}:`, error)\r\n    return { data: null, error }\r\n  }\r\n}\r\n\r\n// Generic update helper\r\nexport async function update<T = any>(\r\n  table: string,\r\n  id: string,\r\n  updates: Record<string, any>\r\n): Promise<{ data: T | null; error: any }> {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from(table)\r\n      .update(updates)\r\n      .eq('id', id)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(`Update error on ${table}:`, error)\r\n      return { data: null, error }\r\n    }\r\n\r\n    return { data: data as T, error: null }\r\n  } catch (error) {\r\n    console.error(`Unexpected error updating ${table}:`, error)\r\n    return { data: null, error }\r\n  }\r\n}\r\n\r\n// Generic delete helper\r\nexport async function deleteRecord(\r\n  table: string,\r\n  id: string\r\n): Promise<{ success: boolean; error: any }> {\r\n  try {\r\n    const { error } = await supabase\r\n      .from(table)\r\n      .delete()\r\n      .eq('id', id)\r\n\r\n    if (error) {\r\n      console.error(`Delete error on ${table}:`, error)\r\n      return { success: false, error }\r\n    }\r\n\r\n    return { success: true, error: null }\r\n  } catch (error) {\r\n    console.error(`Unexpected error deleting from ${table}:`, error)\r\n    return { success: false, error }\r\n  }\r\n}\r\n\r\n// Get single record by ID\r\nexport async function getById<T = any>(\r\n  table: string,\r\n  id: string\r\n): Promise<{ data: T | null; error: any }> {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from(table)\r\n      .select('*')\r\n      .eq('id', id)\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(`GetById error on ${table}:`, error)\r\n      return { data: null, error }\r\n    }\r\n\r\n    return { data: data as T, error: null }\r\n  } catch (error) {\r\n    console.error(`Unexpected error getting record from ${table}:`, error)\r\n    return { data: null, error }\r\n  }\r\n}\r\n\r\n// Count records\r\nexport async function count(\r\n  table: string,\r\n  filters?: Record<string, any>\r\n): Promise<{ count: number | null; error: any }> {\r\n  try {\r\n    let queryBuilder = supabase\r\n      .from(table)\r\n      .select('*', { count: 'exact', head: true })\r\n\r\n    // Apply filters if provided\r\n    if (filters) {\r\n      Object.entries(filters).forEach(([key, value]) => {\r\n        queryBuilder = queryBuilder.eq(key, value)\r\n      })\r\n    }\r\n\r\n    const { count, error } = await queryBuilder\r\n\r\n    if (error) {\r\n      console.error(`Count error on ${table}:`, error)\r\n      return { count: null, error }\r\n    }\r\n\r\n    return { count, error: null }\r\n  } catch (error) {\r\n    console.error(`Unexpected error counting ${table}:`, error)\r\n    return { count: null, error }\r\n  }\r\n}\r\n\r\n// Advanced query with custom select, filters, sorting, pagination\r\nexport async function advancedQuery<T = any>(options: {\r\n  table: string\r\n  select?: string\r\n  filters?: Record<string, any>\r\n  orderBy?: { column: string; ascending?: boolean }\r\n  limit?: number\r\n  offset?: number\r\n}): Promise<{ data: T[] | null; error: any; count?: number }> {\r\n  try {\r\n    let queryBuilder = supabase\r\n      .from(options.table)\r\n      .select(options.select || '*', { count: 'exact' })\r\n\r\n    // Apply filters\r\n    if (options.filters) {\r\n      Object.entries(options.filters).forEach(([key, value]) => {\r\n        if (value !== undefined && value !== null) {\r\n          queryBuilder = queryBuilder.eq(key, value)\r\n        }\r\n      })\r\n    }\r\n\r\n    // Apply sorting\r\n    if (options.orderBy) {\r\n      queryBuilder = queryBuilder.order(\r\n        options.orderBy.column,\r\n        { ascending: options.orderBy.ascending ?? false }\r\n      )\r\n    }\r\n\r\n    // Apply pagination\r\n    if (options.limit !== undefined) {\r\n      queryBuilder = queryBuilder.limit(options.limit)\r\n    }\r\n    if (options.offset !== undefined) {\r\n      queryBuilder = queryBuilder.range(\r\n        options.offset,\r\n        options.offset + (options.limit || 10) - 1\r\n      )\r\n    }\r\n\r\n    const { data, error, count } = await queryBuilder\r\n\r\n    if (error) {\r\n      console.error(`Advanced query error on ${options.table}:`, error)\r\n      return { data: null, error, count: undefined }\r\n    }\r\n\r\n    return { data: data as T[], error: null, count: count ?? undefined }\r\n  } catch (error) {\r\n    console.error(`Unexpected error in advanced query:`, error)\r\n    return { data: null, error, count: undefined }\r\n  }\r\n}\r\n\r\n// Test database connection\r\nexport async function testConnection(): Promise<boolean> {\r\n  try {\r\n    const { error } = await supabase.from('leads').select('count').limit(1)\r\n\r\n    // PGRST205 means table doesn't exist - but connection works!\r\n    if (error && error.code !== 'PGRST205') {\r\n      console.error('Database connection test failed:', error)\r\n      return false\r\n    }\r\n\r\n    // If error is PGRST205, connection is working, tables just don't exist yet\r\n    if (error && error.code === 'PGRST205') {\r\n      console.log('✅ Database connected (tables not created yet)')\r\n      return true\r\n    }\r\n\r\n    console.log('✅ Database connection successful')\r\n    return true\r\n  } catch (error) {\r\n    console.error('Database connection test error:', error)\r\n    return false\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 325, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/lib/modules/crm/analytics.ts"],"sourcesContent":["/**\r\n * CRM Analytics Module\r\n *\r\n * Provides comprehensive analytics calculations for:\r\n * - Key business metrics (MRR, ARR, LTV, CAC, etc.)\r\n * - Conversion funnel analysis\r\n * - Time-series data (leads/revenue over time)\r\n * - Performance tracking\r\n */\r\n\r\nimport { query } from '@/lib/db'\r\nimport type { Lead, Subscription, Generation, EmailLog } from '@/types'\r\n\r\nexport interface Metrics {\r\n  totalLeads: number\r\n  totalContacted: number\r\n  totalOpened: number\r\n  totalClicked: number\r\n  totalSubscribed: number\r\n  totalDelivered: number\r\n  totalCanceled: number\r\n  mrr: number\r\n  arr: number\r\n  conversionRate: number\r\n  openRate: number\r\n  clickRate: number\r\n  clickToSubscribeRate: number\r\n  avgRevenuePerLead: number\r\n  ltv: number\r\n  cac: number\r\n  churnRate: number\r\n  activeSubscriptions: number\r\n}\r\n\r\n/**\r\n * Calculate all key business metrics\r\n */\r\nexport async function calculateMetrics(): Promise<Metrics> {\r\n  console.log('Calculating CRM metrics...')\r\n\r\n  // Fetch all data\r\n  const { data: leads } = await query<Lead>('leads')\r\n  const { data: allSubscriptions } = await query<Subscription>('subscriptions')\r\n  const { data: generations } = await query<Generation>('generations')\r\n\r\n  const totalLeads = leads?.length || 0\r\n  const totalContacted = leads?.filter((l) => l.email_sent_at).length || 0\r\n  const totalOpened = leads?.filter((l) => l.email_opened_at).length || 0\r\n  const totalClicked = leads?.filter((l) => l.email_clicked_at).length || 0\r\n\r\n  // Active subscriptions\r\n  const activeSubscriptions = allSubscriptions?.filter((s) => s.status === 'active') || []\r\n  const totalSubscribed = activeSubscriptions.length\r\n\r\n  // Delivered and canceled\r\n  const totalDelivered = leads?.filter((l) => l.status === 'delivered').length || 0\r\n  const totalCanceled = leads?.filter((l) => l.status === 'canceled').length || 0\r\n\r\n  // Revenue calculations\r\n  const mrr = activeSubscriptions.reduce((sum, s) => sum + Number(s.amount), 0)\r\n  const arr = mrr * 12\r\n\r\n  // Conversion rates\r\n  const conversionRate = totalContacted > 0 ? (totalSubscribed / totalContacted) * 100 : 0\r\n  const openRate = totalContacted > 0 ? (totalOpened / totalContacted) * 100 : 0\r\n  const clickRate = totalOpened > 0 ? (totalClicked / totalOpened) * 100 : 0\r\n  const clickToSubscribeRate =\r\n    totalClicked > 0 ? (totalSubscribed / totalClicked) * 100 : 0\r\n\r\n  // Average revenue per lead\r\n  const avgRevenuePerLead = totalLeads > 0 ? mrr / totalLeads : 0\r\n\r\n  // Customer Acquisition Cost (CAC)\r\n  const totalCost = generations?.reduce((sum, g) => sum + Number(g.cost_usd || 0), 0) || 0\r\n  const cac = totalSubscribed > 0 ? totalCost / totalSubscribed : 0\r\n\r\n  // Lifetime Value (LTV) - simplified: average subscription * 12 months\r\n  const ltv = totalSubscribed > 0 ? (mrr / totalSubscribed) * 12 : 0\r\n\r\n  // Churn Rate - canceled / total ever subscribed\r\n  const totalEverSubscribed = allSubscriptions?.length || 0\r\n  const churnRate =\r\n    totalEverSubscribed > 0 ? (totalCanceled / totalEverSubscribed) * 100 : 0\r\n\r\n  console.log('Metrics calculated:', {\r\n    totalLeads,\r\n    totalSubscribed,\r\n    mrr,\r\n    conversionRate: conversionRate.toFixed(2) + '%',\r\n  })\r\n\r\n  return {\r\n    totalLeads,\r\n    totalContacted,\r\n    totalOpened,\r\n    totalClicked,\r\n    totalSubscribed,\r\n    totalDelivered,\r\n    totalCanceled,\r\n    mrr,\r\n    arr,\r\n    conversionRate,\r\n    openRate,\r\n    clickRate,\r\n    clickToSubscribeRate,\r\n    avgRevenuePerLead,\r\n    ltv,\r\n    cac,\r\n    churnRate,\r\n    activeSubscriptions: totalSubscribed,\r\n  }\r\n}\r\n\r\n/**\r\n * Get leads created over time\r\n */\r\nexport async function getLeadsOverTime(days: number = 30): Promise<Array<{ date: string; count: number }>> {\r\n  console.log(`Getting leads over last ${days} days...`)\r\n\r\n  const { data: leads } = await query<Lead>('leads')\r\n\r\n  const dates = []\r\n  for (let i = days - 1; i >= 0; i--) {\r\n    const date = new Date()\r\n    date.setDate(date.getDate() - i)\r\n    const dateStr = date.toISOString().split('T')[0]\r\n\r\n    const count =\r\n      leads?.filter((l) => l.created_at?.split('T')[0] === dateStr).length || 0\r\n\r\n    dates.push({ date: dateStr, count })\r\n  }\r\n\r\n  return dates\r\n}\r\n\r\n/**\r\n * Get revenue over time (monthly)\r\n */\r\nexport async function getRevenueOverTime(\r\n  months: number = 12\r\n): Promise<Array<{ month: string; revenue: number; subscriptions: number }>> {\r\n  console.log(`Getting revenue over last ${months} months...`)\r\n\r\n  const { data: subscriptions } = await query<Subscription>('subscriptions')\r\n\r\n  const monthsData = []\r\n  for (let i = months - 1; i >= 0; i--) {\r\n    const date = new Date()\r\n    date.setMonth(date.getMonth() - i)\r\n    const monthStr = date.toISOString().substring(0, 7) // YYYY-MM\r\n\r\n    const monthSubs = subscriptions?.filter((s) => s.created_at?.startsWith(monthStr)) || []\r\n\r\n    const revenue = monthSubs.reduce((sum, s) => sum + Number(s.amount), 0)\r\n\r\n    monthsData.push({\r\n      month: monthStr,\r\n      revenue,\r\n      subscriptions: monthSubs.length,\r\n    })\r\n  }\r\n\r\n  return monthsData\r\n}\r\n\r\n/**\r\n * Get conversion funnel metrics\r\n */\r\nexport interface FunnelStage {\r\n  name: string\r\n  count: number\r\n  rate: number\r\n  dropOffRate?: number\r\n}\r\n\r\nexport async function getFunnelMetrics(): Promise<FunnelStage[]> {\r\n  console.log('Calculating funnel metrics...')\r\n\r\n  const metrics = await calculateMetrics()\r\n\r\n  const stages: FunnelStage[] = [\r\n    { name: 'Contacted', count: metrics.totalContacted, rate: 100 },\r\n    {\r\n      name: 'Opened',\r\n      count: metrics.totalOpened,\r\n      rate: metrics.openRate,\r\n      dropOffRate: 100 - metrics.openRate,\r\n    },\r\n    {\r\n      name: 'Clicked',\r\n      count: metrics.totalClicked,\r\n      rate: metrics.clickRate,\r\n      dropOffRate: 100 - metrics.clickRate,\r\n    },\r\n    {\r\n      name: 'Subscribed',\r\n      count: metrics.totalSubscribed,\r\n      rate: metrics.clickToSubscribeRate,\r\n      dropOffRate: 100 - metrics.clickToSubscribeRate,\r\n    },\r\n    {\r\n      name: 'Delivered',\r\n      count: metrics.totalDelivered,\r\n      rate: metrics.totalSubscribed > 0 ? (metrics.totalDelivered / metrics.totalSubscribed) * 100 : 0,\r\n    },\r\n  ]\r\n\r\n  return stages\r\n}\r\n\r\n/**\r\n * Get leads grouped by status for Kanban board\r\n */\r\nexport async function getLeadsByStatus() {\r\n  console.log('Getting leads grouped by status...')\r\n\r\n  const { data: leads } = await query<Lead>('leads')\r\n\r\n  const grouped = {\r\n    pending: leads?.filter((l) => l.status === 'pending') || [],\r\n    contacted: leads?.filter((l) => l.status === 'contacted') || [],\r\n    opened: leads?.filter((l) => l.status === 'opened') || [],\r\n    clicked: leads?.filter((l) => l.status === 'clicked') || [],\r\n    subscribed: leads?.filter((l) => l.status === 'subscribed') || [],\r\n    delivered: leads?.filter((l) => l.status === 'delivered') || [],\r\n    canceled: leads?.filter((l) => l.status === 'canceled') || [],\r\n  }\r\n\r\n  return grouped\r\n}\r\n\r\n/**\r\n * Get recent activity feed\r\n */\r\nexport interface Activity {\r\n  id: string\r\n  type: 'lead_added' | 'email_sent' | 'email_opened' | 'email_clicked' | 'payment_received' | 'website_delivered'\r\n  leadName: string\r\n  leadId: string\r\n  timestamp: string\r\n  metadata?: Record<string, any>\r\n}\r\n\r\nexport async function getRecentActivity(limit: number = 20): Promise<Activity[]> {\r\n  console.log(`Getting recent ${limit} activities...`)\r\n\r\n  const activities: Activity[] = []\r\n\r\n  // Get recent leads\r\n  const { data: leads } = await query<Lead>('leads')\r\n  const sortedLeads = leads?.sort((a, b) =>\r\n    new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\r\n  ) || []\r\n\r\n  for (const lead of sortedLeads.slice(0, limit)) {\r\n    // Lead added\r\n    activities.push({\r\n      id: `lead-${lead.id}`,\r\n      type: 'lead_added',\r\n      leadName: lead.business_name,\r\n      leadId: lead.id,\r\n      timestamp: lead.created_at,\r\n    })\r\n\r\n    // Email sent\r\n    if (lead.email_sent_at) {\r\n      activities.push({\r\n        id: `email-sent-${lead.id}`,\r\n        type: 'email_sent',\r\n        leadName: lead.business_name,\r\n        leadId: lead.id,\r\n        timestamp: lead.email_sent_at,\r\n      })\r\n    }\r\n\r\n    // Email opened\r\n    if (lead.email_opened_at) {\r\n      activities.push({\r\n        id: `email-opened-${lead.id}`,\r\n        type: 'email_opened',\r\n        leadName: lead.business_name,\r\n        leadId: lead.id,\r\n        timestamp: lead.email_opened_at,\r\n      })\r\n    }\r\n\r\n    // Email clicked\r\n    if (lead.email_clicked_at) {\r\n      activities.push({\r\n        id: `email-clicked-${lead.id}`,\r\n        type: 'email_clicked',\r\n        leadName: lead.business_name,\r\n        leadId: lead.id,\r\n        timestamp: lead.email_clicked_at,\r\n      })\r\n    }\r\n\r\n    // Website delivered\r\n    if (lead.status === 'delivered') {\r\n      activities.push({\r\n        id: `delivered-${lead.id}`,\r\n        type: 'website_delivered',\r\n        leadName: lead.business_name,\r\n        leadId: lead.id,\r\n        timestamp: lead.updated_at,\r\n      })\r\n    }\r\n  }\r\n\r\n  // Sort by timestamp and limit\r\n  return activities\r\n    .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\r\n    .slice(0, limit)\r\n}\r\n\r\n/**\r\n * Get revenue by industry\r\n */\r\nexport async function getRevenueByIndustry(): Promise<Array<{ industry: string; revenue: number; count: number }>> {\r\n  console.log('Calculating revenue by industry...')\r\n\r\n  const { data: leads } = await query<Lead>('leads')\r\n  const { data: subscriptions } = await query<Subscription>('subscriptions', { status: 'active' })\r\n\r\n  // Group subscriptions by industry\r\n  const industryMap = new Map<string, { revenue: number; count: number }>()\r\n\r\n  for (const sub of subscriptions || []) {\r\n    const lead = leads?.find((l) => l.id === sub.lead_id)\r\n    if (!lead) continue\r\n\r\n    const industry = lead.industry || 'Unknown'\r\n    const current = industryMap.get(industry) || { revenue: 0, count: 0 }\r\n\r\n    industryMap.set(industry, {\r\n      revenue: current.revenue + Number(sub.amount),\r\n      count: current.count + 1,\r\n    })\r\n  }\r\n\r\n  return Array.from(industryMap.entries()).map(([industry, data]) => ({\r\n    industry,\r\n    revenue: data.revenue,\r\n    count: data.count,\r\n  }))\r\n}\r\n\r\n/**\r\n * Get best performing email subject lines\r\n */\r\nexport async function getBestSubjectLines(limit: number = 5) {\r\n  console.log('Getting best performing subject lines...')\r\n\r\n  const { data: emailLogs } = await query<EmailLog>('email_logs')\r\n\r\n  // Group by subject\r\n  const subjectMap = new Map<string, { opens: number; total: number }>()\r\n\r\n  for (const log of emailLogs || []) {\r\n    const current = subjectMap.get(log.subject) || { opens: 0, total: 0 }\r\n\r\n    subjectMap.set(log.subject, {\r\n      opens: current.opens + (log.opened_at ? 1 : 0),\r\n      total: current.total + 1,\r\n    })\r\n  }\r\n\r\n  // Calculate open rates and sort\r\n  return Array.from(subjectMap.entries())\r\n    .map(([subject, data]) => ({\r\n      subject,\r\n      opens: data.opens,\r\n      total: data.total,\r\n      openRate: (data.opens / data.total) * 100,\r\n    }))\r\n    .sort((a, b) => b.openRate - a.openRate)\r\n    .slice(0, limit)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 611, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kuziv/Desktop/Desktop%20Folders/Client%20Projects/MVp/mvp-web-agency/app/api/admin/analytics/route.ts"],"sourcesContent":["/**\r\n * Admin Analytics API\r\n *\r\n * GET /api/admin/analytics\r\n * Returns comprehensive analytics data\r\n */\r\n\r\nimport { NextResponse } from 'next/server'\r\nimport {\r\n  calculateMetrics,\r\n  getLeadsOverTime,\r\n  getRevenueOverTime,\r\n  getFunnelMetrics,\r\n  getRevenueByIndustry,\r\n  getBestSubjectLines,\r\n} from '@/lib/modules/crm/analytics'\r\n\r\nexport async function GET() {\r\n  try {\r\n    const [metrics, leadsOverTime, revenueOverTime, funnelMetrics, revenueByIndustry, bestSubjects] =\r\n      await Promise.all([\r\n        calculateMetrics(),\r\n        getLeadsOverTime(30),\r\n        getRevenueOverTime(12),\r\n        getFunnelMetrics(),\r\n        getRevenueByIndustry(),\r\n        getBestSubjectLines(5),\r\n      ])\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      analytics: {\r\n        metrics,\r\n        leadsOverTime,\r\n        revenueOverTime,\r\n        funnelMetrics,\r\n        revenueByIndustry,\r\n        bestSubjects,\r\n      },\r\n    })\r\n  } catch (error) {\r\n    console.error('Error fetching analytics:', error)\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: 'Failed to fetch analytics',\r\n        details: error instanceof Error ? error.message : 'Unknown error',\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;AAED;AACA;;;AASO,eAAe;IACpB,IAAI;QACF,MAAM,CAAC,SAAS,eAAe,iBAAiB,eAAe,mBAAmB,aAAa,GAC7F,MAAM,QAAQ,GAAG,CAAC;YAChB,IAAA,wJAAgB;YAChB,IAAA,wJAAgB,EAAC;YACjB,IAAA,0JAAkB,EAAC;YACnB,IAAA,wJAAgB;YAChB,IAAA,4JAAoB;YACpB,IAAA,2JAAmB,EAAC;SACrB;QAEH,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,WAAW;gBACT;gBACA;gBACA;gBACA;gBACA;gBACA;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAE3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}